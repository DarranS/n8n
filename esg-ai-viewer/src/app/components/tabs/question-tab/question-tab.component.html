<div class="question-tab-container" #containerRef>
  <h2>
    Ask a Question
    <span *ngIf="isMultiCompany">({{ companies.length }} Companies)</span>
  </h2>
  <div class="form-header">
    <span class="company-display">
      <b *ngIf="!isMultiCompany">{{ companyName }} <span *ngIf="companyIsin">(ISIN: {{ companyIsin }})</span></b>
    </span>
  </div>
  <mat-tab-group [(selectedIndex)]="selectedTabIndex" *ngIf="!isMultiCompany">
    <mat-tab label="Guided">
      <app-guided-question-tab
        [companyName]="companyName"
        [companyIsin]="companyIsin"
        [loading]="loading"
        [audienceOptions]="audienceOptions"
        [toneOptions]="toneOptions"
        [depthOptions]="depthOptions"
        [outputFormatOptions]="outputFormatOptions"
        [warning]="warning"
        [guidedPromptOutOfDate]="guidedPromptOutOfDate"
        [generatedPrompt]="generatedPrompt"
        [includePromptIntention]="includePromptIntention"
        [includeNumericData]="includeNumericData"
        [perspective]="perspective"
        [question]="question"
        [audience]="audience"
        [tone]="tone"
        [depth]="depth"
        [outputFormat]="outputFormat"
        (ask)="handleGuidedAsk()"
        (askAndSave)="handleGuidedAskAndSave()"
        (generatePrompt)="handleGuidedGeneratePrompt()"
        (copyPrompt)="handleGuidedCopyPrompt()"
        (questionChange)="question = $event"
        (audienceChange)="audience = $event"
        (toneChange)="tone = $event"
        (depthChange)="depth = $event"
        (outputFormatChange)="outputFormat = $event"
        (perspectiveChange)="perspective = $event"
        (includeNumericDataChange)="includeNumericData = $event"
        (includePromptIntentionChange)="includePromptIntention = $event"
      ></app-guided-question-tab>
    </mat-tab>
    <mat-tab label="Simple">
      <app-simple-question-tab
        [companyName]="companyName"
        [companyIsin]="companyIsin"
        [loading]="loading"
        (ask)="handleSimpleAsk($event)"
        (askAndSave)="handleSimpleAskAndSave($event)"
        (generatePrompt)="handleSimpleGeneratePrompt($event)"
      ></app-simple-question-tab>
    </mat-tab>
  </mat-tab-group>
  <div *ngIf="isMultiCompany">
    <div class="question-form">
      <!-- Multi-company logic here -->
    </div>
  </div>

  <div *ngIf="loading && isMultiCompany" class="loading-container" style="margin-top: 2rem; text-align: center;">
    <mat-spinner diameter="32"></mat-spinner>
    <div style="margin-top: 1rem; font-size: 1.1rem;">{{ statusMessage }}</div>
  </div>
  <div *ngIf="loading && !isMultiCompany" class="loading-container">
    <mat-spinner diameter="32"></mat-spinner>
    <span>Getting answer...</span>
  </div>

  <div *ngIf="error" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <span>{{ error }}</span>
  </div>

  <div *ngIf="formattedAnswer" class="answer-container">
    <span class="answer-label">Answer:</span>
    <div [innerHTML]="formattedAnswer"></div>
    <button mat-icon-button (click)="copyAnswer()" [disabled]="!answer" title="Copy to clipboard">
      <mat-icon>content_copy</mat-icon>
    </button>
    <button mat-icon-button (click)="exportCurrentAnswer()" [disabled]="!answer" matTooltip="Export answer to Word">
      <mat-icon>description</mat-icon>
    </button>
    <div *ngIf="guidedPromptOutOfDate && answer" class="error-container">
      <mat-icon color="warn">warning</mat-icon>
      <span>{{ warning }}</span>
    </div>
    <div class="answer-meta" *ngIf="answer">
      <span>Characters: {{ answer.length }}</span> |
      <span>Words: {{ answerWordCount }}</span>
    </div>
  </div>
</div>

<style>
.disabled-controls {
  pointer-events: none;
  opacity: 0.6;
}
.spinner-center {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
::ng-deep .mat-mdc-tab-body-content {
  overflow: visible !important;
  max-height: none !important;
}
::ng-deep .mat-mdc-dialog-surface {
  padding-left: 8px !important;
  padding-right: 8px !important;
  border-radius: 16px !important;
  box-shadow: 0 8px 32px rgba(0,0,0,0.18) !important;
}
.question-tab-container {
  width: 100%;
  box-sizing: border-box;
  padding: 32px !important;
}
</style> 